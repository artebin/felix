#!/usr/bin/env bash

########################################################################################################
# Start xss-lock to lock the session for events: suspend, hibernate, lock-session, and unlock-session.
# See <https://wiki.archlinux.org/title/Power_management#xss-lock>
#
# It does not work well with dm-tool, we use i3lock instead.
########################################################################################################
xss-lock -- i3lock -n -notify 20 -notifier "notify-send '' 'The screen will be locked in 20 seconds...'" &

##################################
# Force loading of libgtk3-nocsd
##################################
export LD_PRELOAD="libgtk3-nocsd.so.0${LD_PRELOAD:+:$LD_PRELOAD}"

#########################
# Environment variables
#########################

#export JDK_HOME=""
#export JRE_HOME=""
#export ANT_HOME=""
#export MVN_HOME=""

if [[ ! -z "${JDK_HOME}" ]]; then
	export PATH=${JDK_HOME}/bin:${PATH}
fi

if [[ ! -z "${ANT_HOME}" ]]; then
	export PATH=${ANT_HOME}/bin:${PATH}
fi

if [[ ! -z "${MVN_HOME}" ]]; then
	export PATH=${MVN_HOME}/bin:${PATH}
fi

#export GPODDER_HOME=""
#export GPODDER_DOWNLOAD_DIR=""

######################################################
# Register Thunar in D-BUS if you wish to use thunar
######################################################
#thunar --daemon &

##########################################################################################
# Keyboard should be set properly in /etc/default/keyboard but if you wish to do it here
##########################################################################################
#setxkbmap -rules evdev -model evdev -layout us -variant altgr-intl &

##########
# Polkit
##########
/usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &

#############
# clipmenud
#############
bash "${HOME}/scripts/clipmenud_run.sh" &

#################
# Hotkey daemon
#################
sxhkd &

############################################################################
# Multimedia keys can be managed by xfce4-volumed if sxhkd is not doing it
############################################################################

#xfce4-volumed &

############################
# Re-configure the screens
############################

#xrandr --output LVDS-1 --off --output DP-1 --off --output HDMI-1 --mode 1360x768 --primary --pos 0x0 --rotate normal --output VGA-1 --off &

###########
# Xmodmap
###########
if [[ -f "${HOME}/.Xmodmap" ]]; then
	xmodmap .Xmodmap
fi

#################################################################################
# DPMS (Display Power Management Signaling) is controlled with the xset command
# See <https://wiki.archlinux.org/index.php/Display_Power_Management_Signaling>
#################################################################################

# Query the current settings
# xset q
#
# Disable screen saver blanking
# xset s off
#
# Change blank time to 1 hour
# xset s 3600 3600
#
# Turn off DPMS
# xset -dpms
#
# Disable DPMS and prevent screen from blanking
# xset s off -dpms
#
# Turn off screen immediately
# xset dpms force off
#
# Standy screen
# xset dpms force standy
#
# Suspend screen
# xset dpms force suspend
#

#############
# Wallpaper
#############
bash "${HOME}/.local/share/wallpapers/set_wallpaper.sh" &

####################
# Bluetooth applet
####################
blueman-applet &

################################
# SSH agent for X applications
################################
if [[ -d "${HOME}/.ssh" ]]; then
	HOME_LINK_SSH_AUTH_SOCK="${HOME}/.ssh/ssh_auth_sock"
	if [[ ! -S "${HOME_LINK_SSH_AUTH_SOCK}" ]]; then
		eval `ssh-agent`
		ln -sf "${SSH_AUTH_SOCK}" "${HOME_LINK_SSH_AUTH_SOCK}"
	fi
	export SSH_AUTH_SOCK="${HOME_LINK_SSH_AUTH_SOCK}"
	ssh-add -l > /dev/null || ssh-add
fi
