#!/usr/bin/env bash

function print_usage(){
	cat << EOF
Usage: ${BASH_SOURCE} [-m]
This script calls rofi itself when executed with no arguments.

Options:
  -m    Must be used when calling the script as a rofi modi, like below:
        rofi -show winlayout -modi winlayout:"rofi-winlayout -m"
EOF
}

function print_rofi_menu(){
	echo -e "\0prompt\x1fload winlayout"
	find "${HOME}/.config/winlayout" -mindepth 1 -maxdepth 1 -type d -exec basename {} \;
}

ROFI_MODI="false"
while getopts "hm" ARG; do
	case "${ARG}" in
		h)
			print_usage
			exit 0
			;;
		m)
			ROFI_MODI="true"
			;;
		*)
			print_usage
			exit 1
			;;
	esac
done
shift $((OPTIND-1))

if ! ${ROFI_MODI}; then
	coproc ( rofi -show winlayout -modi winlayout:"rofi-winlayout -m" )
else
	if [[ "${ROFI_RETV}" -eq 0 ]]; then
		print_rofi_menu
	elif [[ "${ROFI_RETV}" -eq 1 ]]; then
		coproc ( winlayout -l "${1}" >/dev/null 2>&1 )
	fi
fi
